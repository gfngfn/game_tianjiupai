-module('Tianjiupai.RoomServer').
-export(['monitor'/1, 'start_link'/2, 'as_pid'/1, 'from_pid'/1, 'call'/3, 'get_whole_state'/1, 'get_personal_state'/2, 'send_chat'/3, 'attend'/3, 'exit'/2, 'submit'/3, 'ack'/3, 'require_next_inning'/3, 'set_connection'/3]).
'monitor'(S2091RoomId) -> begin S2092ProcOpt = 'Tianjiupai.RoomServer.Impl':'where_is_global'(S2091RoomId), case S2092ProcOpt of {'ok', S2093Proc} -> begin S2094Mref = 'SesterlStdlib.MonitorRef':'monitor'('Tianjiupai.RoomServer.Impl':'as_pid'(S2093Proc)), sesterl_internal_prim:'return'({'ok', S2094Mref}) end; 'error' -> sesterl_internal_prim:'return'('error') end end.
'start_link'(S2096RoomId, S2097RoomName) -> 'Tianjiupai.RoomServer.Impl':'start_link_name'({S2096RoomId, S2097RoomName}, {'global', S2096RoomId}).
'as_pid'(S2099Proc) -> 'Tianjiupai.RoomServer.Impl':'as_pid'(S2099Proc).
'from_pid'(S2101Proc) -> 'Tianjiupai.RoomServer.Impl':'from_pid'(S2101Proc).
'call'(S2103RoomId, S2104Req, S2105F) -> begin S2106ProcOpt = 'Tianjiupai.RoomServer.Impl':'where_is_global'(S2103RoomId), case S2106ProcOpt of 'error' -> sesterl_internal_prim:'return'('error'); {'ok', S2107Proc} -> begin S2108RespResult = 'Tianjiupai.RoomServer.Impl':'call'(S2107Proc, S2104Req), case S2108RespResult of {'ok', S2109Resp} -> S2105F(S2109Resp); {'error', S2110Err} -> begin _ = begin S3298 = 'Tianjiupai.Logger':'warning'({"call failed (room_id: ~s, req: ~p, proc: ~p, error: ~p)", 4}, {S2103RoomId, S2104Req, S2107Proc, S2110Err}), S3298(<<"RoomServer.sest">>, 1564) end, sesterl_internal_prim:'return'('error') end end end end end.
'get_whole_state'(S2112RoomId) -> 'Tianjiupai.RoomServer':'call'(S2112RoomId, 'get_whole_state', fun({'whole_state', S2113WholeState}) -> sesterl_internal_prim:'return'({'ok', S2113WholeState}) end).
'get_personal_state'(S2115RoomId, S2116UserId) -> 'Tianjiupai.RoomServer':'call'(S2115RoomId, {'get_personal_state', S2116UserId}, fun({'personal_state', S2117PersonalStateOpt}) -> sesterl_internal_prim:'return'(S2117PersonalStateOpt) end).
'send_chat'(S2119RoomId, S2120User, S2121Text) -> 'Tianjiupai.RoomServer':'call'(S2119RoomId, {'send_chat', S2120User, S2121Text}, fun('chat_sent') -> sesterl_internal_prim:'return'({'ok', ok}) end).
'attend'(S2123RoomId, S2124User, S2125WsProc) -> 'Tianjiupai.RoomServer':'call'(S2123RoomId, {'attend', S2124User, S2125WsProc}, fun({'attended', S2126GameStateOpt}) -> sesterl_internal_prim:'return'(S2126GameStateOpt) end).
'exit'(S2128RoomId, S2129UserId) -> 'Tianjiupai.RoomServer':'call'(S2128RoomId, {'exit', S2129UserId}, fun({'exited', S2130Success}) -> case S2130Success of true -> sesterl_internal_prim:'return'({'ok', ok}); false -> sesterl_internal_prim:'return'('error') end end).
'submit'(S2132RoomId, S2133UserId, S2134Cards) -> 'Tianjiupai.RoomServer':'call'(S2132RoomId, {'submit', S2133UserId, S2134Cards}, fun({'submission_done', S2135V}) -> sesterl_internal_prim:'return'(S2135V) end).
'ack'(S2137RoomId, S2138UserId, S2139SnapshotId) -> begin S2140ProcOpt = 'Tianjiupai.RoomServer.Impl':'where_is_global'(S2137RoomId), case S2140ProcOpt of 'error' -> sesterl_internal_prim:'return'(ok); {'ok', S2141Proc} -> 'Tianjiupai.RoomServer.Impl':'cast'(S2141Proc, {'ack', S2138UserId, S2139SnapshotId}) end end.
'require_next_inning'(S2143RoomId, S2144UserId, S2145SnapshotId) -> begin S2146ProcOpt = 'Tianjiupai.RoomServer.Impl':'where_is_global'(S2143RoomId), case S2146ProcOpt of 'error' -> sesterl_internal_prim:'return'(ok); {'ok', S2147Proc} -> 'Tianjiupai.RoomServer.Impl':'cast'(S2147Proc, {'require_next_inning', S2144UserId, S2145SnapshotId}) end end.
'set_connection'(S2149RoomId, S2150UserId, S2151WsProc) -> begin S2152ProcOpt = 'Tianjiupai.RoomServer.Impl':'where_is_global'(S2149RoomId), case S2152ProcOpt of 'error' -> sesterl_internal_prim:'return'(ok); {'ok', S2153Proc} -> 'Tianjiupai.RoomServer.Impl':'cast'(S2153Proc, {'set_connection', S2150UserId, S2151WsProc}) end end.
