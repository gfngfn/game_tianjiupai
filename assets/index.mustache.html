<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>tianjiupai</title>
    <script type="text/javascript" charset="UTF-8" src="assets/main.js"></script>
  </head>
  <body>
    <div id="app">(Elm manipulates here)</div>
    <script type="text/javascript">
        var app = Elm.Main.init({
          node: document.getElementById("app"),
          flags: {{flags}}
        })

        app.ports.listenWebSocket.subscribe(function(url) {
          var socket = new WebSocket(url);
          socket.onopen = () => {
            app.ports.onOpenWebSocket.send({socket: socket});
          };
          socket.addEventListener("message", function(event) {
            app.ports.receiveWebSocketMessage.send(event.data);
          });
        });

        app.ports.sendWebSocketMessage.subscribe(function(array) {
          const [{socket: socket}, message] = array;
          socket.send(message);
        });
    </script>
  </body>
</html>
