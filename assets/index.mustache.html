<!DOCTYPE html>
<html>
  <head>
    <title>tianjiupai</title>
    <script src="assets/main.js" type="text/javascript"></script>
  </head>
  <body>
    <div id="app">(Elm manipulates here)</div>
    <script type="text/javascript">
        var app = Elm.Main.init({
          node: document.getElementById("app"),
          flags: {{flags}}
        })

        app.ports.listenWebSocket.subscribe(function(url) {
          var socket = new WebSocket(url);
          socket.onopen = () => {
            app.ports.onOpenWebSocket.send({socket: socket});
          };
          socket.addEventListener("message", function(event) {
            app.ports.receiveWebSocketMessage.send(event.data);
          });
        });

        app.ports.sendWebSocketMessage.subscribe(function(array) {
          const [{socket: socket}, message] = array;
          socket.send(message);
        });
    </script>
  </body>
</html>
